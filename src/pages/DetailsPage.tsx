import  "../../src/cssFile/DetailsPage.css";
import { useState } from "react";
import { useLocation, useNavigate } from "react-router-dom";
import type { Person } from "../mockData";

type LocationState = {
  person?: Person;
};

type ClientType = "individual" | "business";

type Question = {
  id: string;
  text: string;
};

type QuestionSection = {
  id: string;
  title: string;
  description?: string;
  questions: Question[];
};
 const individualSections: QuestionSection[] = [
  {
    id: "ind_sec_1",
    title: "أ. ممارسات مناخية إيجابية ذكية",
    description: "تحقق من وجود ممارسات زراعية وتقنيات تدعم التكيف مع المناخ.",
    questions: [
      {
        id: "ind_q1",
        text: "هل يطبق المشروع ممارسات الري والتسميد الفعالة (على سبيل المثال، التقطير المدمج (داخل الأنبوب)، وأشرطة التنقيط، والأنظمة المنخفضة الضغط أو تحت السطحي؛ والتسميد بالري الذي يوصل العناصر الغذائية بالماء عن طريق التنقيط)؟",
      },
      {
        id: "ind_q2",
        text: "هل تم دمج تكنولوجيا الطاقة المتجددة والتحكم في المناخ في العمليات (على سبيل المثال، مضخات الري التي تعمل بالطاقة الشمسية، والتجفيف الشمسي، ووقود الغاز الحيوي، والبيوت البلاستيكية، والأنفاق الزراعية (العالية/المنخفضة)، أو بيوت الظل الشبكية للحماية من الحرارة، أو غيرها من المعدات المستدامة والفعالة في استخدام الموارد)؟",
      },
      {
        id: "ind_q3",
        text: "هل يتم استخدام أصناف المحاصيل المقاومة للمناخ وممارسات تحسين التربة لتحسين الإنتاجية والاحتفاظ بالمياه (على سبيل المثال، القمح المقاوم للجفاف، والطماطم المقاومة للملوحة، مشاتل مع شتلات محسّنة، البقوليات الموفرة للمياه، السماد، التغطية بالغطاء النباتي، الفحم الحيوي)؟",
      },
      {
        id: "ind_q4",
        text: "هل ينفذ المشروع أساليب الزراعة البيئية التي تدعم مكافحة الآفات والتنوع البيولوجي (على سبيل المثال، الإدارة المتكاملة للآفات عن طريق المكافحة البيولوجية، والمصائد الفرمونية، والرشاشات النباتية؛ وتناوب المحاصيل أو الزراعة المتداخلة مثل الحبوب مع البقوليات، والذرة مع الفاصوليا)؟",
      },
      {
        id: "ind_q5",
        text: "هل يتضمن المشروع تقنيات مستدامة لإنتاج الثروة الحيوانية؟ (على سبيل المثال، برنامج تربية سلالات مقاومة لتغير المناخ، أو إنتاج الأعلاف في المناطق المناسبة، أو تحسين البنية التحتية للمياه للثروة الحيوانية)؟",
      },
      {
        id: "ind_q6",
        text: "هل يتضمن المشروع أنظمة التخزين والتداول المستدامة بعد الحصاد (على سبيل المثال، التخزين المبرد، معامل التجفيف، مرافق التعبئة والتدريج، معدات التصنيع، التبريد التبخيري منخفض التكلفة)؟",
      },
      {
        id: "ind_q7",
        text: "هل يتم تطبيق تدابير الحفاظ على الموارد الأرضية والمائية (على سبيل المثال، المصاطب والسدود الحجرية على التلال، وحصاد مياه الأمطار، والخزانات الجوفية، وإعادة تأهيل الأراضي وإعادة زراعتها بالأنواع المحلية)؟",
      },
    ],
  },
  {
    id: "ind_sec_2",
    title: "ب. الفوائد الاجتماعية والبيئية الإيجابية",
    description: "قياس الأثر الاجتماعي للمشروع على الفئات الضعيفة والاستدامة.",
    questions: [
      {
        id: "ind_q8",
        text: "هل يعمل المشروع بشكل فعال على إشراك الشباب أو النساء أو الفئات الضعيفة الأخرى أو الاستفادة منها من خلال تحسين وصولهم إلى التمويل أو الدخل أو الموارد، وخاصة بالطرق التي تعزز قدرتهم على الصمود في مواجهة تغير المناخ أو قدرتهم على التكيف؟",
      },
      {
        id: "ind_q9",
        text: "هل يعمل المشروع على توسيع نطاق وصول الشباب والنساء والفئات الضعيفة الأخرى إلى الممارسات الذكية مناخيًا والموارد الإنتاجية (مثل المياه) التي يمكنهم استخدامها بشكل مستدام؟",
      },
      {
        id: "ind_q10",
        text: "هل يعمل المشروع على خلق أو تعزيز سبل العيش ومصادر الدخل، مثل توليد فرص العمل أو تحسين الوصول إلى الأسواق، مما يقلل من تعرض الشباب والنساء وغيرهم من الفئات الضعيفة للهشاشة الناتجة عن التغير المناخي؟",
      },
      {
        id: "ind_q11",
        text: "هل يعمل المشروع على بناء المهارات العملية وشبكة العلاقات والوصول إلى الخدمات التي تعزز القدرة على التكيف مع المناخ والجاهزية؟ (على سبيل المثال، تعزيز المعرفة بالمعلومات المناخية، تحسين توفير المعلومات وتطوير العلاقات مع مقدمي الإرشاد أو مقدمي الخدمات الزراعية)؟",
      },
    ],
  },
  {
    id: "ind_sec_3",
    title: "ج. استبعادي",
    description: "التحقق من عدم وجود أنشطة مستبعدة أو عالية الضرر.",
    questions: [
      {
        id: "ind_q12",
        text: "هل سيؤدي المشروع إلى فقدان التنوع البيولوجي أو الإضرار بالموائل الحساسة؟ (على سبيل المثال، إزالة النباتات الأصيلة، زراعة الأراضي غير المزروعة سابقًا، أو التأثير على الأراضي في المناطق المحمية)؟",
      },
      {
        id: "ind_q13",
        text: "هل سيؤدي المشروع إلى استخدام غير مستدام للمياه أو استنزاف طبقات المياه الجوفية المحلية؟ (على سبيل المثال، استخراج المياه من الآبار العميقة الخاصة/غير المنظمة، أو الري بالغمر في الأراضي الهامشية)؟",
      },
      {
        id: "ind_q14",
        text: "هل يتم استخدام أو التخطيط لاستخدام مواد كيميائية محظورة أو شديدة الخطورة؟ (على سبيل المثال، المبيدات الحشرية غير المعتمدة بموجب القانون الأردني أو المعايير الدولية)؟",
      },
      {
        id: "ind_q15",
        text: "هل سيؤدي المشروع إلى تدهور التربة دون وجود خطة للتعافي أو الحماية؟ (على سبيل المثال، الزراعة في منحدرات معرضة للتعرية، والإفراط في استخدام الأسمدة الاصطناعية، وزيادة أحجام القطعان بشكل غير مستدام خلال ظروف الجفاف)؟",
      },
      {
        id: "ind_q16",
        text: "هل يتضمن المشروع نزاعات على الأراضي أو تهجير أو قضايا حيازة؟ (على سبيل المثال، الزراعة على الأراضي المتنازع عليها، أو إخلاء المستأجرين)؟",
      },
      {
        id: "ind_q17",
        text: "هل هناك انتهاكات تتعلق بالعمل، مثل عمالة الأطفال أو ظروف العمل غير الآمنة؟ (على سبيل المثال، القُصّر العاملين في معامل التصنيع، القُصّر الذين يتعاملون مع المواد الكيميائية الزراعية، نقص معدات الحماية)؟",
      },
      {
        id: "ind_q18",
        text: "هل سيعمل المشروع على المواقع الثقافية أو التاريخية أو سيؤثر عليها؟ (على سبيل المثال، التأثير السلبي على المواقع الثقافية أو الأثرية، حفر خنادق الري بالقرب من المواقع التاريخية أو المحمية أو التسييج الذي يمنع وصول السياح)؟",
      },
    ],
  },
  {
    id: "ind_sec_4",
    title: "د. الأنشطة ذات المخاطر المتزايدة",
    description: "تحديد الأنشطة ذات المخاطر المناخية/البيئية العالية.",
    questions: [
      {
        id: "ind_q19",
        text: "هل هناك ممارسات تُسبب انبعاثات غازات دفيئة عالية دون اتباع نهج للتخفيف منها؟ (على سبيل المثال، حرق المخلفات في الهواء الطلق، والاستخدام المفرط للوقود دون بدائل للطاقة)؟",
      },
      {
        id: "ind_q20",
        text: "هل هناك زراعة أحادية للأنواع غير المحلية دون اتباع نهج لإدارة المخاطر للحد من الانتشار غير المنضبط للأنواع غير المحلية؟ (على سبيل المثال، مزارع الكينا أو الموز في المناطق القاحلة)؟",
      },
      {
        id: "ind_q21",
        text: "هل سيتسبب المشروع في تلوث أو تدهور المياه أو التربة أو الهواء؟ (على سبيل المثال، جريان المواد الكيميائية الزراعية في الجداول، أو مياه الصرف الصحي غير المعالجة، أو تفاقم مشكلة التربة المالحة، أو استخدام المياه غير المتجددة، وزيادة غير مستدامة في أحجام القطيع)؟",
      },
    ],
  },
  {
    id: "ind_sec_5",
    title: "هـ. القدرات والاستعداد للتنفيذ",
    description: "تقييم قدرات مقدم الطلب والبنية التحتية لدعم التنفيذ.",
    questions: [
      {
        id: "ind_q22",
        text: "هل يمتلك مقدم الطلب القدرة والمهارات والدعم المطلوبين، أو هل لديه خطة لتطوير هذه القدرات من أجل تنفيذ المشروع بشكل مستدام؟ (على سبيل المثال، المهارات المناسبة لتشغيل نظام الري أو البيوت البلاستيكية، والفهم المناسب لتقنيات التخزين/المعالجة)؟",
      },
      {
        id: "ind_q23",
        text: "هل هناك إمكانية وصول كافية إلى الموارد والبنية الأساسية لدعم التنفيذ؟ (على سبيل المثال، الوصول إلى المياه أو الكهرباء، والنقل/الطرق للوصول إلى الأسواق، ومرافق تخزين المنتجات أو المواد، وما إلى ذلك)؟",
      },
      {
        id: "ind_q24",
        text: "هل يمتلك مقدم الطلب معرفة مالية أو لديه أنظمة إدارة مالية قائمة لضمان الشفافية والاستدامة، مثل أنظمة أو خطط لتتبع النفقات؟",
      },
    ],
  },
];
const businessSections: QuestionSection[] = [
  {
    id: "bus_sec_1",
    title: "أ. ممارسات مناخية إيجابية ذكية",
    description: "تحقق من الممارسات المناخية الذكية والتقنيات المستخدمة في المنشأة.",
    questions: [
      {
        id: "bus_q1",
        text: "هل يطبق المشروع ممارسات الري والتسميد الفعالة (على سبيل المثال، التقطير المدمج (داخل الأنبوب)، وأشرطة التنقيط، والأنظمة المنخفضة الضغط أو تحت السطحي؛ والتسميد بالري الذي يوصل العناصر الغذائية بالماء عن طريق التنقيط)؟",
      },
      {
        id: "bus_q2",
        text: "هل تم دمج تكنولوجيا الطاقة المتجددة والتحكم في المناخ في العمليات (على سبيل المثال، مضخات الري التي تعمل بالطاقة الشمسية، والتجفيف الشمسي، ووقود الغاز الحيوي، والبيوت البلاستيكية، والأنفاق الزراعية العالية/المنخفضة، أو بيوت الظل الشبكية للحماية من الحرارة، أو غيرها من المعدات المستدامة والفعالة في استخدام الموارد)؟",
      },
      {
        id: "bus_q3",
        text: "هل يتم استخدام أصناف المحاصيل المقاومة للمناخ وممارسات تحسين التربة لتحسين الإنتاجية والاحتفاظ بالمياه (على سبيل المثال، القمح المقاوم للجفاف، والطماطم المقاومة للملوحة، مشاتل مع شتلات محسّنة، البقوليات الموفرة للمياه، السماد، التغطية بالغطاء النباتي، الفحم الحيوي)؟",
      },
      {
        id: "bus_q4",
        text: "هل ينفذ المشروع أساليب الزراعة البيئية التي تدعم مكافحة الآفات والتنوع البيولوجي (على سبيل المثال، الإدارة المتكاملة للآفات عن طريق المكافحة البيولوجية، والمصائد الفرمونية، والرشاشات النباتية؛ وتناوب المحاصيل أو الزراعة المتداخلة مثل الحبوب مع البقوليات، والذرة مع الفاصوليا)؟",
      },
      {
        id: "bus_q5",
        text: "هل سيتم استخدام أدوات أو أنظمة إدارة المعلومات أو برمجيات لتحسين تتبع المبيعات والنفقات والأرباح والتحكم في المخزون وإدارة عروض المنتجات وما إلى ذلك؟",
      },
      {
        id: "bus_q6",
        text: "هل يتضمن المشروع تقنيات مستدامة لإنتاج الثروة الحيوانية؟ (على سبيل المثال، برنامج تربية سلالات مقاومة لتغير المناخ، أو إنتاج الأعلاف في المناطق المناسبة، أو تحسين البنية التحتية للمياه للثروة الحيوانية)؟",
      },
      {
        id: "bus_q7",
        text: "هل يتضمن المشروع أنظمة التخزين والتداول المستدامة بعد الحصاد (على سبيل المثال، التخزين المبرد، معامل التجفيف، مرافق التعبئة والتدريج، معدات التصنيع، التبريد التبخيري منخفض التكلفة)؟",
      },
      {
        id: "bus_q8",
        text: "هل يتم تطبيق تدابير الحفاظ على الموارد الأرضية والمائية (على سبيل المثال، المصاطب والسدود الحجرية على التلال، وحصاد مياه الأمطار، والخزانات الجوفية، وإعادة تأهيل الأراضي وإعادة زراعتها بالأنواع المحلية)؟",
      },
    ],
  },
  {
    id: "bus_sec_2",
    title: "ب. الفوائد الاجتماعية والبيئية الإيجابية",
    description: "قياس أثر المشروع على الفئات الضعيفة، وفرص العمل، وسلاسل القيمة.",
    questions: [
      {
        id: "bus_q9",
        text: "هل يعمل المشروع بشكل فعال على إشراك الشباب أو النساء أو الفئات الضعيفة الأخرى أو الاستفادة منها من خلال تحسين وصولهم إلى التمويل أو الدخل أو الموارد، وخاصة بالطرق التي تعزز قدرتهم على الصمود في مواجهة تغير المناخ أو قدرتهم على التكيف؟",
      },
      {
        id: "bus_q10",
        text: "هل يوفر المشروع خدمات الإرشاد المدمجة (التدريب، المشورة الفنية، الوصول إلى المدخلات)؟",
      },
      {
        id: "bus_q11",
        text: "هل يخلق المشروع فرص عمل دائمة جديدة؟",
      },
      {
        id: "bus_q12",
        text: "هل يخلق المشروع فرص عمل جديدة موسمية أو مؤقتة؟",
      },
      {
        id: "bus_q13",
        text: "هل جزء من الوظائف الجديدة مخصص للنساء والشباب (تحت 35 سنة)؟",
      },
      {
        id: "bus_q14",
        text: "هل يعمل المشروع على تحسين وصول المزارعين إلى المدخلات (البذور والأسمدة والأدوات)؟",
      },
      {
        id: "bus_q15",
        text: "هل يساهم المشروع في تحسين قدرة المزارعين على الوصول إلى الأسواق؟",
      },
      {
        id: "bus_q16",
        text: "هل يقدم المشروع للمزارعين أسعارًا أفضل من السعر السائد في السوق؟",
      },
      {
        id: "bus_q17",
        text: "هل يقدم المشروع قيمة مضافة لممارسات ما بعد الحصاد (على سبيل المثال، المعالجة، التخزين، الخدمات اللوجستية)؟",
      },
      {
        id: "bus_q18",
        text: "هل يساهم المشروع في تقليل خسائر ما بعد الحصاد بالنسبة للمزارعين؟",
      },
      {
        id: "bus_q19",
        text: "هل يزيد المشروع من حصة المواد الخام التي يتم الحصول عليها محليًا؟",
      },
      {
        id: "bus_q20",
        text: "هل يساهم المشروع في زيادة دخل المزارعين بشكل مباشر؟",
      },
    ],
  },
  {
    id: "bus_sec_3",
    title: "ج. استبعادي",
    description: "التأكد من عدم وجود أنشطة مخالفة أو عالية الضرر بيئيًا أو اجتماعيًا.",
    questions: [
      {
        id: "bus_q21",
        text: "هل سيؤدي المشروع إلى فقدان التنوع البيولوجي أو الإضرار بالموائل الحساسة؟ (على سبيل المثال، إزالة النباتات الأصلية، زراعة الأراضي غير المزروعة سابقًا، أو التأثير على الأراضي في المناطق المحمية)؟",
      },
      {
        id: "bus_q22",
        text: "هل سيؤدي المشروع إلى استخدام غير مستدام للمياه أو استنزاف طبقات المياه الجوفية المحلية؟ (على سبيل المثال، استخراج المياه من الآبار العميقة الخاصة/غير المنظمة، أو الري بالغمر في الأراضي الهامشية)؟",
      },
      {
        id: "bus_q23",
        text: "هل يتم استخدام أو التخطيط لاستخدام مواد كيميائية محظورة أو شديدة الخطورة؟ (على سبيل المثال، المبيدات الحشرية غير المعتمدة بموجب القانون الأردني أو المعايير الدولية)؟",
      },
      {
        id: "bus_q24",
        text: "هل سيؤدي المشروع إلى تدهور التربة دون وجود خطة للتعافي أو الحماية؟ (على سبيل المثال، الزراعة المعرضة للتآكل على المنحدرات الشديدة، والإفراط في استخدام الأسمدة الاصطناعية، وزيادة أحجام القطعان بشكل غير مستدام خلال ظروف الجفاف)؟",
      },
      {
        id: "bus_q25",
        text: "هل يتضمن المشروع نزاعات على الأراضي أو تهجيرًا أو قضايا حيازة؟ (على سبيل المثال، الزراعة على الأراضي المتنازع عليها، أو إخلاء المستأجرين)؟",
      },
      {
        id: "bus_q26",
        text: "هل هناك انتهاكات تتعلق بالعمل، مثل عمالة الأطفال أو ظروف العمل غير الآمنة؟ (على سبيل المثال، القاصرين العاملين في معامل التصنيع، القاصرون الذين يتعاملون مع المواد الكيميائية الزراعية، نقص معدات الحماية)؟",
      },
      {
        id: "bus_q27",
        text: "هل سيعمل المشروع على المواقع الثقافية أو التاريخية أو سيؤثر عليها؟ (على سبيل المثال، التأثير السلبي على المواقع الثقافية أو الأثرية، حفر خنادق الري بالقرب من المواقع التاريخية أو المحمية أو التسييج الذي يمنع وصول السياح)؟",
      },
    ],
  },
  {
    id: "bus_sec_4",
    title: "د. الأنشطة ذات المخاطر المتزايدة",
    description: "تحديد الأنشطة التي قد تتسبب في مخاطر بيئية أو مناخية مرتفعة.",
    questions: [
      {
        id: "bus_q28",
        text: "هل هناك ممارسات تُسبب انبعاثات غازات دفيئة عالية دون اتباع نهج للتخفيف منها؟ (على سبيل المثال، حرق المخلفات في الهواء الطلق، والاستخدام المفرط للوقود دون بدائل للطاقة)؟",
      },
      {
        id: "bus_q29",
        text: "هل هناك زراعة أحادية للأنواع غير المحلية دون اتباع نهج لإدارة المخاطر للحد من الانتشار غير المنضبط للأنواع غير المحلية؟ (على سبيل المثال، مزارع الكينا أو الموز في المناطق القاحلة)؟",
      },
      {
        id: "bus_q30",
        text: "هل سيتسبب المشروع في تلوث أو تدهور المياه أو التربة أو الهواء؟ (على سبيل المثال، جريان المواد الكيميائية الزراعية في الجداول، أو مياه الصرف الصحي غير المعالجة، أو تفاقم مشكلة التربة المالحة، أو استخدام المياه غير المتجددة، وزيادة غير مستدامة في أحجام القطيع)؟",
      },
    ],
  },
  {
    id: "bus_sec_5",
    title: "هـ. القدرات والاستعداد للتنفيذ",
    description: "تقييم قدرات المنشأة والشركاء على تنفيذ المشروع بصورة مستدامة.",
    questions: [
      {
        id: "bus_q31",
        text: "هل هناك خطة في إشراك المجتمعات المحلية وأصحاب المصلحة بشكل فعال؟ (على سبيل المثال، الاستشارات مع مقدمي الخدمات الإرشادية، وأعضاء المجتمع، والمدخلات من مجموعات السيدات، والمنظمات غير الحكومية، ومقدمي الخدمات من القطاع الخاص)؟",
      },
      {
        id: "bus_q32",
        text: "هل يمتلك مقدم الطلب القدرة والمهارات والدعم المطلوبين، أو هل لديهم خطة لتطوير هذه القدرات من أجل تنفيذ المشروع المستدام؟ (على سبيل المثال، المهارات المناسبة لتشغيل نظام الري أو البيوت البلاستيكية، والفهم المناسب لتقنيات التخزين/المعالجة)؟",
      },
      {
        id: "bus_q33",
        text: "هل هناك إمكانية وصول كافية إلى الموارد والبنية الأساسية لدعم التنفيذ؟ (على سبيل المثال، الوصول إلى المياه أو الكهرباء، والنقل/الطرق للوصول إلى الأسواق، ومرافق تخزين المنتجات أو المواد، وما إلى ذلك)؟",
      },
      {
        id: "bus_q34",
        text: "هل يمتلك مقدم الطلب معرفة مالية أو لديه أنظمة إدارة مالية قائمة لضمان الشفافية والاستدامة، مثل أنظمة أو خطط لتتبع النفقات؟",
      },
    ],
  },
];


type AnswerValue = "yes" | "no" | "na";

export default function DetailsPage() {
  const navigate = useNavigate();
  const location = useLocation();
  const state = location.state as LocationState | null;

  const person = state?.person;
  const [clientType, setClientType] = useState<ClientType | null>(null);
  const [answers, setAnswers] = useState<Record<string, AnswerValue>>({});

  if (!person) {
    return (
      <div className="page page--centered">
        <div className="card">
          <p>لا توجد بيانات عميل. الرجاء العودة لصفحة البحث.</p>
          <div className="card__footer">
            <button className="btn btn-primary" onClick={() => navigate("/")}>
              الرجوع لصفحة البحث
            </button>
          </div>
        </div>
      </div>
    );
  }

  const sections: QuestionSection[] =
    clientType === "individual"
      ? individualSections
      : clientType === "business"
      ? businessSections
      : [];

  const handleAnswerChange = (questionId: string, value: AnswerValue) => {
    setAnswers((prev) => ({ ...prev, [questionId]: value }));
  };

  const handleSubmit = () => {
    console.log("Person:", person);
    console.log("Client type:", clientType);
    console.log("Answers:", answers);
    alert("تم حفظ التقييم (Mock). يمكنك لاحقًا ربطه بالـ API.");
  };

  const getAnsweredCount = () =>
    Object.keys(answers).filter((k) => answers[k]).length;

  const getTotalQuestions = () =>
    sections.reduce((sum, sec) => sum + sec.questions.length, 0);

  return (
    <div className="page page--centered">
      <div className="card card--wide">
        {/* هيدر */}
        <div className="card__header">
          <h1 className="page-title">تقييم طلب القرض</h1>
          <p className="page-subtitle">
            مراجعة بيانات العميل والإجابة على أقسام أسئلة الفحص حسب نوع
            العميل.
          </p>
        </div>

        {/* بيانات العميل */}
        <div className="selected-card">
          <h3>بيانات العميل الأساسية</h3>
          <div className="detail-grid">
            <div>
              <strong>الاسم:</strong> {person.name}
            </div>
            <div>
              <strong>الرقم الوطني:</strong> {person.nationalId}
            </div>
            <div>
              <strong>الجنس:</strong> {person.gender}
            </div>
            <div>
              <strong>العمر:</strong> {person.age}
            </div>
            <div>
              <strong>الشركة:</strong> {person.company}
            </div>
            <div>
              <strong>المحافظة:</strong> {person.governorate}
            </div>
          </div>
        </div>

        {/* نوع العميل + ملخص التقدّم */}
        <div className="questionnaire-header">
          <div className="client-type">
            <span className="form-label">نوع العميل</span>
            <div className="client-type__options">
              <label className="chip-radio">
                <input
                  type="radio"
                  name="clientType"
                  value="individual"
                  checked={clientType === "individual"}
                  onChange={() => setClientType("individual")}
                />
                <span>العملاء الأفراد</span>
              </label>

              <label className="chip-radio">
                <input
                  type="radio"
                  name="clientType"
                  value="business"
                  checked={clientType === "business"}
                  onChange={() => setClientType("business")}
                />
                <span>عملاء الأعمال</span>
              </label>
            </div>
          </div>

          <div className="questionnaire-progress">
            <span className="questionnaire-progress__label">
              حالة الإجابة على الأسئلة
            </span>
            <div className="questionnaire-progress__bar">
              <div
                className="questionnaire-progress__fill"
                style={{
                  width:
                    sections.length === 0
                      ? "0%"
                      : `${
                          Math.round(
                            (getAnsweredCount() /
                              Math.max(getTotalQuestions(), 1)) *
                              100
                          ) || 0
                        }%`,
                }}
              />
            </div>
            <span className="questionnaire-progress__text">
              {getAnsweredCount()} / {getTotalQuestions()} سؤال مجاب
            </span>
          </div>
        </div>

        {/* الأقسام والأسئلة */}
        {clientType ? (
          <div className="questionnaire">
            <div className="questionnaire__sections">
              {sections.map((section) => (
                <section
                  key={section.id}
                  className="questionnaire-section"
                  id={section.id}
                >
                  <header className="questionnaire-section__header">
                    <h3 className="questionnaire-section__title">
                      {section.title}
                    </h3>
                    {section.description && (
                      <p className="questionnaire-section__description">
                        {section.description}
                      </p>
                    )}
                  </header>

                  <div className="questionnaire-section__body">
                    {section.questions.map((q, idx) => {
                      const value = answers[q.id];
                      const isUnanswered = !value;

                      return (
                        <div
                          key={q.id}
                          className={
                            "question-row" +
                            (isUnanswered ? " question-row--unanswered" : "")
                          }
                        >
                          <div className="question-text">
                            <span className="question-number">
                              {idx + 1}.
                            </span>
                            <span>{q.text}</span>
                          </div>

                          <div className="question-answers">
                            <label>
                              <input
                                type="radio"
                                name={q.id}
                                value="yes"
                                checked={value === "yes"}
                                onChange={() =>
                                  handleAnswerChange(q.id, "yes")
                                }
                              />
                              <span>نعم</span>
                            </label>
                            <label>
                              <input
                                type="radio"
                                name={q.id}
                                value="no"
                                checked={value === "no"}
                                onChange={() =>
                                  handleAnswerChange(q.id, "no")
                                }
                              />
                              <span>لا</span>
                            </label>
                            <label>
                              <input
                                type="radio"
                                name={q.id}
                                value="na"
                                checked={value === "na"}
                                onChange={() =>
                                  handleAnswerChange(q.id, "na")
                                }
                              />
                              <span>غير قابل للتطبيق</span>
                            </label>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </section>
              ))}
            </div>
          </div>
        ) : (
          <p className="questions-empty" style={{ marginTop: 16 }}>
            الرجاء اختيار نوع العميل لعرض أقسام الأسئلة.
          </p>
        )}

        {/* أزرار التنقل */}
    <div className="card__footer card__footer--space-between">
  <button className="btn" onClick={() => navigate(-1)}>
    رجوع
  </button>
  <div>
    <button
      className="btn"
      style={{ marginLeft: "8px" }}
      onClick={() => alert("تم حفظ التقييم (Mock).")}
      disabled={!clientType}
    >
      حفظ التقييم
    </button>
    <button
      className="btn btn-primary"
      onClick={() => navigate("/loan")}
      disabled={!clientType}
    >
      التالي: حاسبة القرض
    </button>
  </div>
</div>
      </div>
    </div>
  );
}
 